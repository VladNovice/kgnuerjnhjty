<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>INVESTCOIN Calculator</title>
  <style>
    :root {
      /* --- –¶–í–ï–¢–û–í–ê–Ø –ü–ê–õ–ò–¢–†–ê (Navy + Gold) --- */
      --color-bg: #0B1120; 
      --color-secondary-bg: #151E32; 
      --color-input-bg: #1C263E; 
      
      --top-padding: 33px; 
      
      --color-gold: #FFC400; 
      --color-gold-hover: #E6B000;
      
      --color-text: #F0F4F8; 
      --color-secondary-text: #94A3B8; 
      
      --color-risk: #FF453A;
      --color-profit: #32D74B;

      --bingx-grad-1: #00A6FF;
      --bingx-grad-2: #00D4FF;
      --bingx-grad-3: #5B3BFF;
    }

    *, *::before, *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      background-color: var(--color-bg);
      background-image: radial-gradient(circle at 50% 0%, #1a2640 0%, var(--color-bg) 80%);
      color: var(--color-text);
      font-family: 'Segoe UI', Tahoma, sans-serif;
      height: 100vh !important;
      width: 100vw !important;
      position: fixed;
      top: 0;
      left: 0;
      padding-top: env(safe-area-inset-top);
      overscroll-behavior-y: none;
    }
    body {
      display: flex;
      flex-direction: column;
    }
    .container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 16px;
      padding-top: 0; 
      overflow-y: auto;
      max-width: 600px;
      margin: 0 auto;
      width: 100%;
      -webkit-overflow-scrolling: touch;
    }

    /* --- –•–ï–î–ï–† --- */
    header.header { 
      margin-top: 0 !important;
      margin-bottom: 20px; /* –£–º–µ–Ω—å—à–µ–Ω –æ—Ç—Å—Ç—É–ø */
      padding-top: calc(env(safe-area-inset-top) + var(--top-padding)) !important;
      display: flex;
      flex-direction: column;
      align-items: center; 
      justify-content: center;
      padding-left: 5px;
      padding-right: 5px; 
      width: 100%;
      text-align: center;
      flex-shrink: 0;
    }

    .main-title {
      display: block;
      font-family: 'Arial Black', 'Impact', sans-serif;
      font-size: clamp(1.4rem, 7.5vw, 3.2rem); 
      font-weight: 900;
      color: #FFFFFF; 
      letter-spacing: -1.5px; 
      margin: 0;
      line-height: 1.2; 
      text-transform: uppercase;
      text-shadow: 0 4px 15px rgba(0,0,0,0.3);
      white-space: nowrap; 
      width: 100%;
    }
    
    .subtitle {
      font-size: 0.8rem; 
      color: var(--color-secondary-text); 
      margin-top: 4px;
      letter-spacing: 0.5px;
      font-weight: 600;
      text-transform: uppercase;
    }

    /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
    .main-nav { 
      display: flex; 
      gap: 10px; 
      justify-content: center; 
      margin-bottom: 15px; 
      background: var(--color-secondary-bg); 
      padding: 4px; 
      border-radius: 50px; 
      border: 1px solid #2A3450; 
      flex-shrink: 0;
    }
    .nav-btn { 
      flex: 1; 
      padding: 10px 14px; 
      background: transparent; 
      border: none; 
      border-radius: 50px; 
      color: var(--color-secondary-text); 
      cursor: pointer; 
      font-weight: 600; 
      transition: all 0.3s ease; 
    }
    .nav-btn:hover { color: var(--color-gold); }
    
    .nav-btn.active { 
      background: var(--color-gold); 
      color: #0B1120; 
      box-shadow: 0 2px 8px rgba(255, 196, 0, 0.3); 
    }

    .section { 
      display: none; 
      animation: fadeIn 0.3s ease;
      padding-bottom: 0; 
    }
    .section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

    /* –°–µ—Ç–∫–∞ –∏ –∏–Ω–ø—É—Ç—ã */
    .grid { display: grid; gap: 10px; } /* –ß—É—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ */
    .grid-2 { grid-template-columns: 1fr 1fr; }
    
    input, select { 
      width: 100%; 
      padding: 14px; /* –ß—É—Ç—å –º–µ–Ω—å—à–µ –ø–∞–¥–¥–∏–Ω–≥ */
      background: var(--color-input-bg); 
      border: 1px solid #2A3450; 
      border-radius: 12px; 
      color: var(--color-text); 
      font-size: 0.95rem; 
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    input:focus, select:focus { 
      outline: none; 
      border-color: var(--color-gold); 
      box-shadow: 0 0 0 2px rgba(255, 196, 0, 0.1);
    }
    input::placeholder { color: #5B6B85; }

    /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
    .btn { 
      padding: 12px 18px; /* –ö–æ–º–ø–∞–∫—Ç–Ω–µ–µ */
      border-radius: 12px; 
      background: var(--color-gold); 
      border: none;
      color: #0B1120; 
      font-weight: 700; 
      font-size: 0.95rem; 
      cursor: pointer; 
      transition: all 0.2s ease; 
      box-shadow: 0 4px 15px rgba(255, 196, 0, 0.15); 
    }
    .btn:hover { 
      background: var(--color-gold-hover); 
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 196, 0, 0.25);
    }
    .btn:active { transform: scale(0.96); }

    .results { 
      display: none; 
      margin-top: 10px; 
      background: var(--color-secondary-bg); 
      padding: 15px; 
      border-radius: 12px; 
      text-align: center; 
      font-size: 1rem; 
      line-height: 1.5; 
      border: 1px solid var(--color-gold);
      color: #FFF;
    }

    #entries {
      margin-bottom: 5px; 
    }

    /* --- –°–°–´–õ–ö–ò --- */
    .actions { 
      display: flex; 
      flex-direction: column; 
      gap: 10px; /* –£–º–µ–Ω—å—à–µ–Ω –æ—Ç—Å—Ç—É–ø */
      margin-top: auto;
      padding-top: 10px; 
      padding-bottom: 15px;
      flex-shrink: 0;
    }
    
    .btn-block { 
      display: flex; 
      align-items: center; 
      gap: 12px; 
      padding: 10px 14px; /* –ö–æ–º–ø–∞–∫—Ç–Ω–µ–µ */
      background: var(--color-secondary-bg); 
      border: 1px solid #2A3450;
      border-radius: 14px; 
      cursor: pointer; 
      transition: transform 0.2s, background 0.2s, border-color 0.2s; 
      text-decoration: none; 
      user-select: none;
    }
    .btn-block:hover { 
      transform: translateY(-2px); 
      background: #1C263E; 
      border-color: var(--color-gold); 
    }
    
    .btn-block img, .btn-block svg { 
      width: 36px; /* –ß—É—Ç—å –º–µ–Ω—å—à–µ –∏–∫–æ–Ω–∫–∏ */
      height: 36px; 
      background: #FFFFFF; 
      border-radius: 10px; 
      padding: 4px; 
      object-fit: contain; 
      display: block; 
    }
    .brand-logo { background: none; padding: 0; border-radius: 10px; }

    /* --- –õ–û–ì–û–¢–ò–ü IC --- */
    .mini-ic-logo {
      width: 36px; /* –ß—É—Ç—å –º–µ–Ω—å—à–µ */
      height: 36px; 
      background: linear-gradient(135deg, #FFD700 0%, #FDB931 25%, #d99a06 50%, #FDB931 75%, #FFD700 100%);
      border-radius: 10px; 
      display: flex;
      align-items: center;
      justify-content: center;
      color: #0B1120; 
      font-family: 'Arial Black', 'Verdana', sans-serif;
      font-weight: 900;
      font-size: 1.1rem;
      letter-spacing: -1px;
      line-height: 1;
      padding-right: 1px;
      box-shadow: 
        inset 0 1px 0 rgba(255,255,255,0.6),
        0 4px 10px rgba(255, 196, 0, 0.2);
      border: 1px solid #bf8803;
      position: relative;
      overflow: hidden;
    }
    .mini-ic-logo::after {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 100%);
      border-radius: 10px 10px 0 0;
      pointer-events: none;
    }
    .mini-ic-logo span {
      text-shadow: 0 1px 0 rgba(255,255,255,0.4);
      z-index: 1;
    }

    .btn-content span { font-size: 0.95rem; font-weight: 700; color: #FFF; display: block; margin-bottom: 1px; }
    .btn-desc { font-size: 0.75rem; color: var(--color-secondary-text); }

    .entry-item { display: grid; grid-template-columns: 1fr 1fr auto; gap: 8px; align-items: center; margin-top: 8px; }
    .entry-item button { 
      padding: 12px; 
      background: rgba(255, 69, 58, 0.1); 
      border: 1px solid rgba(255, 69, 58, 0.3); 
      color: #ff5555; 
      border-radius: 10px; 
      cursor: pointer; 
      transition: background 0.2s;
    }
    .entry-item button:hover { background: rgba(255, 69, 58, 0.2); }

    /* --- –ö–û–ú–ü–ê–ö–¢–ù–´–ô –ë–õ–û–ö –°–û–í–ï–¢–û–í (–ò–ó–ú–ï–ù–ï–ù–ò–Ø –ó–î–ï–°–¨) --- */
    .tips-container {
      margin-top: 10px; 
      margin-bottom: 5px;
      /* –£–º–µ–Ω—å—à–∏–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã */
      padding: 10px 14px; 
      
      background: rgba(21, 30, 50, 0.95);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      
      border: 1px solid rgba(255, 196, 0, 0.15);
      border-left: 3px solid var(--color-gold); /* –¢–æ–Ω—å—à–µ –ª–∏–Ω–∏—è */
      border-radius: 10px; /* –ú–µ–Ω—å—à–µ —Ä–∞–¥–∏—É—Å */
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      
      position: relative;
      overflow: hidden;
      
      flex-shrink: 0;
      z-index: 10;
      display: block;
      /* –£–±—Ä–∞–ª–∏ min-height, —á—Ç–æ–±—ã –±–ª–æ–∫ —Å–∂–∏–º–∞–ª—Å—è –ø–æ–¥ –∫–æ–Ω—Ç–µ–Ω—Ç */
    }
    
    .tips-container::before {
      content: '‚Äù';
      position: absolute;
      right: 5px;
      bottom: -15px;
      /* –°–∏–ª—å–Ω–æ —É–º–µ–Ω—å—à–∏–ª–∏ –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—É—é –∫–∞–≤—ã—á–∫—É */
      font-size: 3.5rem; 
      color: rgba(255, 196, 0, 0.05);
      font-family: serif;
      pointer-events: none;
    }
    
    .tips-container.hidden {
      display: none !important;
    }
    
    .tip-header {
      /* –£–º–µ–Ω—å—à–∏–ª–∏ —à—Ä–∏—Ñ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
      font-size: 0.65rem; 
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--color-gold);
      font-weight: 800;
      margin-bottom: 4px; /* –ú–µ–Ω—å—à–µ –æ—Ç—Å—Ç—É–ø */
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .tip-icon {
      font-size: 0.9rem; /* –ú–µ–Ω—å—à–µ –ª–∞–º–ø–æ—á–∫–∞ */
      animation: pulseGold 2s infinite ease-in-out;
    }
    @keyframes pulseGold {
      0% { text-shadow: 0 0 0 rgba(255, 196, 0, 0); transform: scale(1); }
      50% { text-shadow: 0 0 8px rgba(255, 196, 0, 0.6); transform: scale(1.1); }
      100% { text-shadow: 0 0 0 rgba(255, 196, 0, 0); transform: scale(1); }
    }
    
    .tip-text {
      /* –£–º–µ–Ω—å—à–∏–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç */
      font-size: 0.8rem; 
      color: #e2e8f0;
      font-style: italic;
      line-height: 1.35;
      font-family: 'Georgia', serif;
      position: relative;
      z-index: 2;
    }

    footer.footer { 
      text-align: center; 
      padding: 8px 0; 
      color: #5B6B85; 
      font-size: 0.65rem; 
      margin-top: 0;
      flex-shrink: 0;
    }
    
    @media (max-width: 500px) {
      .btn-block { padding: 8px 10px; gap: 10px; }
      .btn-block img, .btn-block svg, .mini-ic-logo { width: 32px; height: 32px; }
      .mini-ic-logo { font-size: 1rem; }
    }
  </style>
</head>
<body>
  <div class="container" id="mainContainer">
    
    <!-- –•–ï–î–ï–† -->
    <header class="header">
      <h1 class="main-title">INVESTCOIN CALCULATOR</h1>
      <p class="subtitle">–°–¥–µ–ª–∞–Ω–æ —Ç—Ä–µ–π–¥–µ—Ä–∞–º–∏ –¥–ª—è —Ç—Ä–µ–π–¥–µ—Ä–æ–≤</p>
    </header>

    <nav class="main-nav" aria-label="–ì–ª–∞–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
      <button class="nav-btn active" id="btn-avg" onclick="switchTab('avg')">–°—Ä–µ–¥–Ω—è—è —Ç–æ—á–∫–∞</button>
      <button class="nav-btn" id="btn-risk" onclick="switchTab('risk')">–†–∏—Å–∫/–û–±—ä—ë–º</button>
    </nav>

    <main class="main-content">
      <section id="avg" class="section active" aria-labelledby="avg-heading">
        <div class="grid">
          <div class="grid grid-2">
            <input type="number" id="newEntryPrice" placeholder="–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞" step="0.0001" min="0.0001" />
            <input type="number" id="newEntryAmount" placeholder="–û–±—ä—ë–º" step="0.0001" min="0.0001" />
          </div>
          <div class="grid grid-2">
            <button class="btn" onclick="addEntry()">+ –î–æ–±–∞–≤–∏—Ç—å</button>
            <button class="btn" onclick="calculateAvg()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
          </div>
          <div id="entries"></div>
        </div>
        <div id="avgResult" class="results" aria-live="polite"></div>
      </section>

      <section id="risk" class="section" aria-labelledby="risk-heading">
        <div class="grid">
          <select id="positionType">
            <option value="long">Long</option>
            <option value="short">Short</option>
          </select>
          <input type="number" id="deposit" placeholder="–î–µ–ø–æ–∑–∏—Ç ($)" min="0.01" step="0.01" />
          <input type="number" id="riskPercent" placeholder="–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É (%)" step="0.1" min="0.1" max="100" />
          <input type="number" id="entryPrice" placeholder="–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞" step="0.0001" min="0.0001" />
          <input type="number" id="stopLoss" placeholder="–°—Ç–æ–ø-–ª–æ—Å—Å" step="0.0001" min="0.0001" />
          <input type="number" id="takeProfit" placeholder="–¢–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" step="0.0001" min="0.0001" />
          <button class="btn" onclick="calculateRisk()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∏—Å–∫</button>
        </div>
        <div id="riskResult" class="results" aria-live="polite"></div>
      </section>
    </main>

    <!-- –ö–û–ú–ü–ê–ö–¢–ù–´–ô –ë–õ–û–ö –°–û–í–ï–¢–û–í -->
    <div class="tips-container" id="tipsBlock">
      <div class="tip-header">
        <span class="tip-icon">üí°</span> –°–û–í–ï–¢–´ –¢–†–ï–ô–î–ï–†–ê
      </div>
      <div id="tipText" class="tip-text">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–≤–µ—Ç–∞...</div>
    </div>

    <!-- –ö–ù–û–ü–ö–ò –°–°–´–õ–û–ö -->
    <div class="actions">
      
      <!-- 1. –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¢–æ—Ä–≥–æ–≤—ã–π –∫–ª—É–± -->
      <div class="btn-block" onclick="window.open('https://t.me/csklad_bot','_blank')" role="link">
        <div class="mini-ic-logo"><span>IC</span></div>
        <div class="btn-content"><span>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–æ—Ä–≥–æ–≤—ã–π –∫–ª—É–±</span><div class="btn-desc">–í—Ö–æ–¥ —á–µ—Ä–µ–∑ –±–æ—Ç–∞ @csklad_bot</div></div>
      </div>

      <!-- 2. –û—Å–Ω–æ–≤–Ω–æ–π –ö–∞–Ω–∞–ª -->
      <div class="btn-block" onclick="window.open('https://t.me/investcoin_free','_blank')" role="link">
        <img src="https://cdn.jsdelivr.net/npm/simple-icons@v6/icons/telegram.svg" alt="Telegram" />
        <div class="btn-content"><span>–û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª</span><div class="btn-desc">–ö–∞–Ω–∞–ª –æ –∑–∞—Ä–∞–±–æ—Ç–∫–µ –Ω–∞ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞—Ö</div></div>
      </div>

      <!-- 3. Bybit -->
      <div class="btn-block" onclick="window.open('https://partner.bybit.com/b/23588','_blank')" role="link">
        <img src="https://upload.wikimedia.org/wikipedia/commons/1/14/Bybit_Logo.svg" alt="Bybit" />
        <div class="btn-content"><span>Bybit</span><div class="btn-desc">–ë–æ–Ω—É—Å –¥–æ 30 000 –¥–æ–ª–ª–∞—Ä–æ–≤</div></div>
      </div>

      <!-- 4. BingX -->
      <div class="btn-block" onclick="window.open('https://bingx.com/invite/INVESTCOIN/','_blank')" role="link">
        <div id="bingxContainer">
          <svg id="bingxLogo" class="brand-logo" viewBox="0 0 100 100" width="36" height="36">
            <defs>
              <linearGradient id="bingxGrad" x1="0" x2="1" y1="0" y2="1">
                <stop offset="0" stop-color="var(--bingx-grad-1)"/>
                <stop offset="0.55" stop-color="var(--bingx-grad-2)"/>
                <stop offset="1" stop-color="var(--bingx-grad-3)"/>
              </linearGradient>
            </defs>
            <rect x="0" y="0" width="100" height="100" rx="20" fill="url(#bingxGrad)"></rect>
            <g transform="translate(18,12) scale(0.7)" fill="#FFFFFF" fill-opacity="0.98">
              <path d="M12 36 L32 12 L54 36 L32 60 Z"></path>
              <path d="M64 24 L76 24 L76 40 L64 40 Z"></path>
            </g>
          </svg>
        </div>
        <div class="btn-content">
          <span>BingX</span>
          <div class="btn-desc">20% —Å–∫–∏–¥–∫–∞ –Ω–∞ –∫–æ–º–∏—Å—Å–∏–∏</div>
        </div>
      </div>

      <!-- 5. Blofin -->
      <div class="btn-block" onclick="window.open('https://blofin.com/activity/ru/regular/2348?referral_code=investcoin','_blank')" role="link">
        <img src="blofin.jpg" alt="Blofin" />
        <div class="btn-content">
          <span>Blofin</span>
          <div class="btn-desc">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ</div>
        </div>
      </div>

    </div>
  </div>

  <footer class="footer">¬© INVESTCOIN Calculator, 2025</footer>

  <script>
    /* --- –£–ü–†–ê–í–õ–ï–ù–ò–ï –í–ö–õ–ê–î–ö–ê–ú–ò –ò –°–í–ê–ô–ü–ê–ú–ò --- */
    let currentTab = 'avg';

    function switchTab(id) {
      currentTab = id;
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      document.getElementById('btn-' + id).classList.add('active');
      document.getElementById('avgResult').style.display = 'none';
      document.getElementById('riskResult').style.display = 'none';

      const tipsBlock = document.getElementById('tipsBlock');
      if (id === 'avg') {
        tipsBlock.classList.remove('hidden');
        setRandomQuote();
      } else {
        tipsBlock.classList.add('hidden');
      }
    }

    /* --- –õ–û–ì–ò–ö–ê –°–í–ê–ô–ü–û–í --- */
    let touchStartX = 0;
    let touchEndX = 0;
    const minSwipeDistance = 50;
    const container = document.getElementById('mainContainer');

    container.addEventListener('touchstart', e => {
      touchStartX = e.changedTouches[0].screenX;
    }, {passive: true});

    container.addEventListener('touchend', e => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    }, {passive: true});

    function handleSwipe() {
      const distance = touchEndX - touchStartX;
      if (Math.abs(distance) < minSwipeDistance) return;
      if (distance < 0 && currentTab === 'avg') switchTab('risk');
      if (distance > 0 && currentTab === 'risk') switchTab('avg');
    }

    /* --- –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä --- */
    let entries = [];

    function addEntry() {
      const price = parseFloat(document.getElementById('newEntryPrice').value);
      const amount = parseFloat(document.getElementById('newEntryAmount').value);
      if (isNaN(price) || price <= 0 || isNaN(amount) || amount <= 0) {
        alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è');
        return;
      }
      if (entries.length >= 10) { alert('–ú–∞–∫—Å–∏–º—É–º 10 —Ç–æ—á–µ–∫ –≤—Ö–æ–¥–∞'); return; }
      entries.push({ price, amount });
      document.getElementById('newEntryPrice').value = '';
      document.getElementById('newEntryAmount').value = '';
      renderEntries();
    }

    function renderEntries() {
      const container = document.getElementById('entries'); container.innerHTML = '';
      entries.forEach((e, i) => {
        const div = document.createElement('div'); div.className = 'entry-item';
        div.innerHTML = `
          <input type="number" value="${e.price}" readonly />
          <input type="number" value="${e.amount}" readonly />
          <button onclick="removeEntry(${i})">‚úï</button>
        `;
        container.appendChild(div);
      });
    }

    function removeEntry(idx) { entries.splice(idx, 1); renderEntries(); }

    function calculateAvg() {
      if (entries.length === 0) { alert('–î–æ–±–∞–≤—å—Ç–µ —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞'); return; }
      const totalValue = entries.reduce((sum, e) => sum + e.price * e.amount, 0);
      const totalAmount = entries.reduce((sum, e) => sum + e.amount, 0);
      const avg = totalValue / totalAmount;
      const avgRes = document.getElementById('avgResult');
      avgRes.textContent = `–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞: ${avg.toFixed(4)}`;
      avgRes.style.display = 'block';
    }

    function calculateRisk() {
      const positionType = document.getElementById('positionType').value;
      let deposit = parseFloat(document.getElementById('deposit').value);
      let riskPercent = parseFloat(document.getElementById('riskPercent').value);
      let entryPrice = parseFloat(document.getElementById('entryPrice').value);
      let stopLoss = parseFloat(document.getElementById('stopLoss').value);
      const tpInput = document.getElementById('takeProfit').value;
      let takeProfit = tpInput ? parseFloat(tpInput) : null;

      if (isNaN(deposit) || deposit <= 0) { alert('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–µ–ø–æ–∑–∏—Ç'); return; }
      if (isNaN(riskPercent) || riskPercent <= 0 || riskPercent > 100) { alert('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∏—Å–∫ %'); return; }
      if (isNaN(entryPrice) || entryPrice <= 0) { alert('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ü–µ–Ω—É –≤—Ö–æ–¥–∞'); return; }
      if (isNaN(stopLoss) || stopLoss <= 0) { alert('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–æ–ø-–ª–æ—Å—Å'); return; }

      if (takeProfit !== null) {
        if (positionType === 'long' && stopLoss > entryPrice && takeProfit < entryPrice) {
          [stopLoss, takeProfit] = [takeProfit, stopLoss];
        }
        if (positionType === 'short' && stopLoss < entryPrice && takeProfit > entryPrice) {
          [stopLoss, takeProfit] = [takeProfit, stopLoss];
        }
      }

      if (positionType === 'long' && stopLoss >= entryPrice) { alert('Long: –°—Ç–æ–ø –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∏–∂–µ –≤—Ö–æ–¥–∞'); return; }
      if (positionType === 'short' && stopLoss <= entryPrice) { alert('Short: –°—Ç–æ–ø –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã—à–µ –≤—Ö–æ–¥–∞'); return; }

      const riskAmount = deposit * (riskPercent / 100);
      const stopDiff = Math.abs(entryPrice - stopLoss);
      const contractSize = riskAmount / stopDiff;
      let profitAmount = null;
      if (takeProfit !== null) {
        profitAmount = contractSize * Math.abs(takeProfit - entryPrice);
      }

      const riskRes = document.getElementById('riskResult');
      let html = `
        <div style="font-size: 1.2em; font-weight: bold; margin-bottom: 8px;">–†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏: ${contractSize.toFixed(4)} –º–æ–Ω–µ—Ç</div>
        <div style="color: var(--color-risk)">–†–∏—Å–∫: -${riskAmount.toFixed(2)} $</div>
      `;
      if (profitAmount !== null) html += `<div style="color: var(--color-profit)">–ü—Ä–æ—Ñ–∏—Ç: +${profitAmount.toFixed(2)} $ (R:R ${(profitAmount/riskAmount).toFixed(1)})</div>`;
      riskRes.innerHTML = html; riskRes.style.display = 'block';
    }

    (function(){
      const container = document.getElementById('bingxContainer');
      if (!container) return;
      const testImg = new Image();
      testImg.onload = function() {
        testImg.width = 36;
        testImg.height = 36;
        testImg.alt = 'BingX';
        testImg.style.borderRadius = '10px';
        testImg.style.padding = '4px';
        testImg.style.objectFit = 'contain';
        testImg.style.background = '#FFF'; 
        container.replaceWith(testImg);
      };
      testImg.src = 'bingx.jpg';
    })();

    const quotes = [
      "¬´–£—Å–ø–µ—Ö –≤ —Ç–æ—Ä–≥–æ–≤–ª–µ ‚Äî —ç—Ç–æ –∑–Ω–∞–Ω–∏–µ —Ä—ã–Ω–∫–æ–≤ –∏ —Å–∞–º–æ–≥–æ —Å–µ–±—è¬ª. –õ. –í–∏–ª—å—è–º—Å",
      "¬´–°–æ–∫—Ä–∞—â–∞–π—Ç–µ —É–±—ã—Ç–∫–∏ –±—ã—Å—Ç—Ä–æ, –ø–æ–∑–≤–æ–ª—è–π—Ç–µ –ø—Ä–∏–±—ã–ª–∏ —Ç–µ—á—å¬ª.",
      "¬´–†—ã–Ω–∫–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—à–∏–±–∞—é—Ç—Å—è, –º–Ω–µ–Ω–∏—è —á–∞—Å—Ç–æ¬ª. –î–∂. –õ–∏–≤–µ—Ä–º–æ—Ä",
      "¬´–¢–æ—Ä–≥—É–π—Ç–µ —Ç–æ, —á—Ç–æ –≤–∏–¥–∏—Ç–µ, –∞ –Ω–µ —Ç–æ, —á—Ç–æ –¥—É–º–∞–µ—Ç–µ¬ª.",
      "¬´–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ —Å–¥–µ–ª–∫—É –∏ —Ç–æ—Ä–≥—É–π—Ç–µ –ø–æ –ø–ª–∞–Ω—É¬ª."
    ];

    function setRandomQuote() {
      const randomIndex = Math.floor(Math.random() * quotes.length);
      const tipsBlock = document.getElementById('tipsBlock');
      if (tipsBlock && !tipsBlock.classList.contains('hidden')) {
        document.getElementById('tipText').textContent = quotes[randomIndex];
      }
    }
    
    if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
      window.Telegram.WebApp.ready();
      window.Telegram.WebApp.expand();
      setTimeout(() => {
        if (window.Telegram.WebApp.requestFullscreen && 
            window.Telegram.WebApp.requestFullscreen.isAvailable()) {
          window.Telegram.WebApp.requestFullscreen();
        }
      }, 100);
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        switchTab('avg');
    });
    
    setRandomQuote();
  </script>
</body>
</html>

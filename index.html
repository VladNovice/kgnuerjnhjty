<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>INVESTCOIN Calculator</title>
  <style>
    :root {
      --bg-color: #0B1120;
      --bg-secondary: #151E32;
      --input-bg: #1C263E;
      --gold: #FFC400;
      --gold-hover: #E6B000;
      --text-main: #F0F4F8;
      --text-muted: #94A3B8;
      --danger: #FF453A;
      --success: #32D74B;
      --safe-top: env(safe-area-inset-top);
    }

    *, *::before, *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: var(--bg-color);
      background-image: radial-gradient(circle at 50% 0%, #1a2640 0%, var(--bg-color) 80%);
      color: var(--text-main);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      min-height: 100vh;
      min-height: 100dvh;
      width: 100vw;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      overscroll-behavior-y: none;
    }

    .container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 0 16px 16px;
      max-width: 600px;
      margin: 0 auto;
      width: 100%;
    }

    header {
      padding-top: calc(var(--safe-top) + 30px);
      margin-bottom: 25px;
      text-align: center;
      flex-shrink: 0;
    }

    .main-title {
      font-family: 'Arial Black', sans-serif;
      font-size: clamp(1.5rem, 6vw, 2.5rem);
      font-weight: 900;
      letter-spacing: -1px;
      text-transform: uppercase;
      text-shadow: 0 4px 15px rgba(0,0,0,0.3);
      line-height: 1.1;
    }

    .subtitle {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-top: 6px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .nav-wrapper {
      background: var(--bg-secondary);
      padding: 4px;
      border-radius: 50px;
      border: 1px solid #2A3450;
      display: flex;
      gap: 5px;
      margin-bottom: 20px;
      flex-shrink: 0;
    }

    .nav-btn {
      flex: 1;
      padding: 10px;
      background: transparent;
      border: none;
      border-radius: 40px;
      color: var(--text-muted);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .nav-btn.active {
      background: var(--gold);
      color: var(--bg-color);
      box-shadow: 0 2px 8px rgba(255, 196, 0, 0.2);
    }

    .section {
      display: none;
      animation: slideUp 0.3s ease-out;
    }

    .section.active {
      display: block;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .grid {
      display: grid;
      gap: 12px;
    }

    .grid-2 {
      grid-template-columns: 1fr 1fr;
    }

    input, select {
      width: 100%;
      padding: 14px 16px;
      background: var(--input-bg);
      border: 1px solid #2A3450;
      border-radius: 12px;
      color: var(--text-main);
      font-size: 16px; 
      appearance: none;
      transition: border-color 0.2s;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--gold);
    }

    .btn {
      padding: 14px;
      border-radius: 12px;
      background: var(--gold);
      border: none;
      color: var(--bg-color);
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.1s;
    }

    .btn:active {
      transform: scale(0.98);
    }

    .results {
      display: none;
      margin-top: 15px;
      background: var(--bg-secondary);
      padding: 16px;
      border-radius: 12px;
      text-align: center;
      border: 1px solid var(--gold);
      line-height: 1.5;
    }

    .entry-list {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .entry-item {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 8px;
    }

    .entry-item button {
      width: 44px;
      background: rgba(255, 69, 58, 0.15);
      border: 1px solid rgba(255, 69, 58, 0.3);
      color: var(--danger);
      border-radius: 12px;
      cursor: pointer;
    }

    .tips-box {
      margin: 15px 0;
      padding: 10px 14px;
      background: rgba(21, 30, 50, 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 196, 0, 0.15);
      border-left: 3px solid var(--gold);
      border-radius: 8px;
      display: none;
    }

    .tips-box.visible {
      display: block;
    }

    .tip-head {
      font-size: 0.7rem;
      color: var(--gold);
      font-weight: 800;
      text-transform: uppercase;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .tip-content {
      font-size: 0.85rem;
      font-style: italic;
      color: #e2e8f0;
      line-height: 1.3;
    }

    .links-area {
      margin-top: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding-bottom: 20px;
    }

    .link-card {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 12px;
      background: var(--bg-secondary);
      border: 1px solid #2A3450;
      border-radius: 14px;
      text-decoration: none;
      transition: transform 0.2s, border-color 0.2s;
    }

    .link-card:active {
      transform: scale(0.98);
      background: #1C263E;
    }

    .link-icon {
      width: 42px;
      height: 42px;
      background: #FFF;
      border-radius: 10px;
      padding: 4px;
      object-fit: contain;
      flex-shrink: 0;
    }

    .ic-logo {
      width: 42px;
      height: 42px;
      background: linear-gradient(135deg, #FFD700, #FDB931);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #000;
      font-weight: 900;
      font-size: 1.2rem;
      border: 1px solid #bf8803;
    }

    .link-info span {
      display: block;
      font-weight: 700;
      color: #FFF;
      font-size: 1rem;
    }

    .link-desc {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 2px;
    }

    footer {
      text-align: center;
      padding: 15px 0;
      color: #475569;
      font-size: 0.75rem;
    }
  </style>
</head>
<body>
  <div class="container" id="app">
    <header>
      <h1 class="main-title">INVESTCOIN</h1>
      <p class="subtitle">Calculator Tool</p>
    </header>

    <nav class="nav-wrapper">
      <button class="nav-btn active" data-tab="avg">–°—Ä–µ–¥–Ω—è—è</button>
      <button class="nav-btn" data-tab="risk">–†–∏—Å–∫ –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç</button>
    </nav>

    <main>
      <section id="avg" class="section active">
        <div class="grid">
          <div class="grid grid-2">
            <input type="number" id="avgPrice" placeholder="–¶–µ–Ω–∞" step="any" inputmode="decimal" />
            <input type="number" id="avgAmount" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" step="any" inputmode="decimal" />
          </div>
          <div class="grid grid-2">
            <button class="btn" id="btnAddEntry">+ –î–æ–±–∞–≤–∏—Ç—å</button>
            <button class="btn" id="btnCalcAvg">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
          </div>
          <div id="entriesList" class="entry-list"></div>
        </div>
        <div id="resAvg" class="results"></div>
      </section>

      <section id="risk" class="section">
        <div class="grid">
          <select id="posType">
            <option value="long">Long (–ü–æ–∫—É–ø–∫–∞)</option>
            <option value="short">Short (–ü—Ä–æ–¥–∞–∂–∞)</option>
          </select>
          <input type="number" id="depo" placeholder="–î–µ–ø–æ–∑–∏—Ç ($)" inputmode="decimal" />
          <input type="number" id="riskPct" placeholder="–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É (%)" inputmode="decimal" />
          <input type="number" id="entPrice" placeholder="–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞" step="any" inputmode="decimal" />
          <input type="number" id="slPrice" placeholder="–°—Ç–æ–ø-–ª–æ—Å—Å" step="any" inputmode="decimal" />
          <input type="number" id="tpPrice" placeholder="–¢–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" step="any" inputmode="decimal" />
          <button class="btn" id="btnCalcRisk">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é</button>
        </div>
        <div id="resRisk" class="results"></div>
      </section>
    </main>

    <div class="tips-box visible" id="tipBox">
      <div class="tip-head">üí° –ú—É–¥—Ä–æ—Å—Ç—å —Ä—ã–Ω–∫–∞</div>
      <div id="tipText" class="tip-content"></div>
    </div>

    <div class="links-area">
      <a href="https://t.me/csklad_bot" target="_blank" class="link-card">
        <div class="ic-logo">IC</div>
        <div class="link-info">
          <span>–¢–æ—Ä–≥–æ–≤—ã–π –∫–ª—É–±</span>
          <div class="link-desc">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ –±–æ—Ç–∞</div>
        </div>
      </a>

      <a href="https://t.me/investcoin_free" target="_blank" class="link-card">
        <img src="https://cdn.jsdelivr.net/npm/simple-icons@v6/icons/telegram.svg" class="link-icon" alt="TG">
        <div class="link-info">
          <span>–û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª</span>
          <div class="link-desc">–ù–æ–≤–æ—Å—Ç–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</div>
        </div>
      </a>

      <a href="https://partner.bybit.com/b/23588" target="_blank" class="link-card">
        <img src="https://upload.wikimedia.org/wikipedia/commons/1/14/Bybit_Logo.svg" class="link-icon" alt="Bybit">
        <div class="link-info">
          <span>Bybit</span>
          <div class="link-desc">–ë–æ–Ω—É—Å—ã –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</div>
        </div>
      </a>

      <a href="https://bingx.com/invite/INVESTCOIN/" target="_blank" class="link-card">
        <svg class="link-icon" viewBox="0 0 100 100" style="background: #FFF; padding: 0;">
           <rect width="100" height="100" rx="10" fill="#0055FF"/>
           <path d="M25 75 L45 25 L65 75 L45 95 Z" fill="white"/>
           <path d="M70 40 L80 40 L80 60 L70 60 Z" fill="white"/>
        </svg>
        <div class="link-info">
          <span>BingX</span>
          <div class="link-desc">–°–∫–∏–¥–∫–∞ 20% –Ω–∞ –∫–æ–º–∏—Å—Å–∏–∏</div>
        </div>
      </a>
    </div>
  </div>

  <footer>¬© 2025 INVESTCOIN Tools</footer>

  <script>
    const $ = id => document.getElementById(id);
    const entries = [];
    
    const quotes = [
      "¬´–£—Å–ø–µ—Ö –≤ —Ç–æ—Ä–≥–æ–≤–ª–µ ‚Äî —ç—Ç–æ –∑–Ω–∞–Ω–∏–µ —Ä—ã–Ω–∫–æ–≤ –∏ —Å–µ–±—è¬ª. –õ–∞—Ä—Ä–∏ –í–∏–ª—å—è–º—Å"
    ];

    function init() {
      if (window.Telegram?.WebApp) {
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        try { tg.requestFullscreen(); } catch(e){}
      }

      setupTabs();
      setupSwipe();
      showRandomQuote();
      
      $('btnAddEntry').onclick = addEntry;
      $('btnCalcAvg').onclick = calcAvg;
      $('btnCalcRisk').onclick = calcRisk;
    }

    function setupTabs() {
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const tab = btn.dataset.tab;
          document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          
          document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
          $(tab).classList.add('active');
          
          $('resAvg').style.display = 'none';
          $('resRisk').style.display = 'none';
          
          const tipBox = $('tipBox');
          if(tab === 'avg') {
            tipBox.classList.add('visible');
            showRandomQuote();
          } else {
            tipBox.classList.remove('visible');
          }
        });
      });
    }

    function showRandomQuote() {
      const txt = quotes[Math.floor(Math.random() * quotes.length)];
      $('tipText').textContent = txt;
    }

    function addEntry() {
      const p = parseFloat($('avgPrice').value);
      const a = parseFloat($('avgAmount').value);
      
      if (!p || !a || p <= 0 || a <= 0) return alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
      if (entries.length >= 10) return alert('–õ–∏–º–∏—Ç —Ç–æ—á–µ–∫ –∏—Å—á–µ—Ä–ø–∞–Ω');

      entries.push({ p, a });
      $('avgPrice').value = '';
      $('avgAmount').value = '';
      renderEntries();
    }

    function renderEntries() {
      const list = $('entriesList');
      list.innerHTML = '';
      entries.forEach((e, i) => {
        const div = document.createElement('div');
        div.className = 'entry-item';
        div.innerHTML = `
          <input type="text" value="${e.p}" readonly tabindex="-1">
          <input type="text" value="${e.a}" readonly tabindex="-1">
          <button onclick="delEntry(${i})">‚úï</button>
        `;
        list.appendChild(div);
      });
    }

    window.delEntry = (i) => {
      entries.splice(i, 1);
      renderEntries();
    };

    function calcAvg() {
      if (!entries.length) return;
      const totalCost = entries.reduce((acc, cur) => acc + (cur.p * cur.a), 0);
      const totalAmt = entries.reduce((acc, cur) => acc + cur.a, 0);
      const avg = totalCost / totalAmt;
      
      const res = $('resAvg');
      res.style.display = 'block';
      res.innerHTML = `
        <div style="color:var(--text-muted); font-size:0.9rem">–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –≤—Ö–æ–¥–∞</div>
        <div style="font-size:1.8rem; font-weight:bold; color:var(--gold)">${avg.toFixed(4)}</div>
        <div style="font-size:0.8rem; margin-top:5px">–í—Å–µ–≥–æ –º–æ–Ω–µ—Ç: ${totalAmt.toFixed(4)}</div>
      `;
    }

    function calcRisk() {
      const type = $('posType').value;
      const bal = parseFloat($('depo').value);
      const risk = parseFloat($('riskPct').value);
      const entry = parseFloat($('entPrice').value);
      const sl = parseFloat($('slPrice').value);
      const tp = parseFloat($('tpPrice').value);

      if (!bal || !risk || !entry || !sl) return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è');
      
      if (type === 'long' && sl >= entry) return alert('–î–ª—è Long —Å—Ç–æ–ø –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∏–∂–µ –≤—Ö–æ–¥–∞');
      if (type === 'short' && sl <= entry) return alert('–î–ª—è Short —Å—Ç–æ–ø –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã—à–µ –≤—Ö–æ–¥–∞');

      const riskMoney = bal * (risk / 100);
      const priceDiff = Math.abs(entry - sl);
      const posSize = riskMoney / priceDiff;
      const posUsdt = posSize * entry;

      let html = `
        <div style="margin-bottom:10px">
          <div style="font-size:0.9rem; color:var(--text-muted)">–û–±—ä–µ–º –ø–æ–∑–∏—Ü–∏–∏</div>
          <div style="font-size:1.4rem; font-weight:bold">${posSize.toFixed(4)} –º–æ–Ω–µ—Ç</div>
          <div style="font-size:0.85rem">Margin: ~${(posUsdt/10).toFixed(2)}$ (–ø—Ä–∏ 10x)</div>
        </div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px; border-top:1px solid #2A3450; padding-top:10px">
          <div style="color:var(--danger)">
            <div>–†–∏—Å–∫</div>
            <b>-${riskMoney.toFixed(2)}$</b>
          </div>
      `;

      if (tp) {
        const tpDiff = Math.abs(tp - entry);
        const profit = posSize * tpDiff;
        const rr = profit / riskMoney;
        html += `
          <div style="color:var(--success)">
            <div>–ü—Ä–æ—Ñ–∏—Ç</div>
            <b>+${profit.toFixed(2)}$</b>
            <div style="font-size:0.75rem">R:R 1:${rr.toFixed(1)}</div>
          </div>
        `;
      } else {
        html += `<div></div>`;
      }
      
      html += `</div>`;
      
      const res = $('resRisk');
      res.innerHTML = html;
      res.style.display = 'block';
    }

    function setupSwipe() {
      let xStart = 0;
      const app = $('app');
      
      app.addEventListener('touchstart', e => xStart = e.changedTouches[0].screenX, {passive: true});
      app.addEventListener('touchend', e => {
        const xEnd = e.changedTouches[0].screenX;
        if (Math.abs(xEnd - xStart) < 60) return;
        
        const active = document.querySelector('.nav-btn.active').dataset.tab;
        if (xEnd < xStart && active === 'avg') $('app').querySelector('[data-tab="risk"]').click();
        if (xEnd > xStart && active === 'risk') $('app').querySelector('[data-tab="avg"]').click();
      }, {passive: true});
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
